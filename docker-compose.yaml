version: '3'

services:
  servidor_1:
    image: linux-cpp
    volumes:
      - .:/work
    networks:
      my_network:
        ipv4_address: 192.168.100.2
    command: bash -c "/usr/bin/g++ -fdiagnostics-color=always -g ${PWD}/Server/src/*.cpp ${PWD}/Common/src/*.cpp -o ${PWD}/Server/main.o && ${PWD}/Server/main.o && tail -f /dev/null"

  servidor_2:
    image: linux-cpp
    volumes:
      - .:/work
    networks:
      my_network:
        ipv4_address: 192.168.100.3
    command: bash -c "/usr/bin/g++ -fdiagnostics-color=always -g ${PWD}/Server/src/*.cpp ${PWD}/Common/src/*.cpp -o ${PWD}/Server/main.o && ${PWD}/Server/main.o 192.168.100.2 && tail -f /dev/null"
  # cliente_1:
  #   image: linux-cpp
  #   volumes:
  #     - .:/work
  #   networks:
  #     my_network:
  #       ipv4_address: 192.168.100.10
  #   ##command: bash -c "sleep 5 && /usr/bin/g++ -fdiagnostics-color=always -g ${PWD}/Client/src/*.cpp ${PWD}/Common/src/*.cpp -o ${PWD}/Client/main.o && ${PWD}/Client/main.o Client_1 192.168.100.2 4000" ## @TODO apagar se nao for usar
  #   command: bash -c "tail -f /dev/null"
  #   ## docker-compose exec cliente_1 bash ## @TODO esse sao os comentarios que tem que executar na infra
  #   ## /usr/bin/g++ -fdiagnostics-color=always -g ${PWD}/Client/src/*.cpp ${PWD}/Common/src/*.cpp -o ${PWD}/Client/main.o && ${PWD}/Client/main.o Client_1 192.168.100.2 4000

  # cliente_2:
  #   image: linux-cpp
  #   volumes:
  #     - .:/work
  #   networks:
  #     my_network:
  #       ipv4_address: 192.168.100.12
  #   ##command: bash -c "sleep 5 && /usr/bin/g++ -fdiagnostics-color=always -g ${PWD}/Client/src/*.cpp ${PWD}/Common/src/*.cpp -o ${PWD}/Client/main.o && ${PWD}/Client/main.o Client_1 192.168.100.2 4000" ## @TODO apagar se nao for usar
  #   command: bash -c "tail -f /dev/null"
  #   ## docker-compose exec cliente_2 bash ## @TODO esse sao os comentarios que tem que executar na infra
  #   ## /usr/bin/g++ -fdiagnostics-color=always -g ${PWD}/Client/src/*.cpp ${PWD}/Common/src/*.cpp -o ${PWD}/Client/main.o && ${PWD}/Client/main.o Client_2 192.168.100.2 4000

  # cliente_3:
  #   image: linux-cpp
  #   volumes:
  #     - .:/work
  #   networks:
  #     my_network:
  #       ipv4_address: 192.168.100.13
  #   ##command: bash -c "sleep 5 && /usr/bin/g++ -fdiagnostics-color=always -g ${PWD}/Client/src/*.cpp ${PWD}/Common/src/*.cpp -o ${PWD}/Client/main.o && ${PWD}/Client/main.o Client_1 192.168.100.2 4000" ## @TODO apagar se nao for usar
  #   command: bash -c "tail -f /dev/null"
  #   ## docker-compose exec cliente_3 bash ## @TODO esse sao os comentarios que tem que executar na infra
  #   ## /usr/bin/g++ -fdiagnostics-color=always -g ${PWD}/Client/src/*.cpp ${PWD}/Common/src/*.cpp -o ${PWD}/Client/main.o && ${PWD}/Client/main.o Client_3 192.168.100.2 4000

networks:
  my_network:
    ipam:
      driver: default
      config:
        - subnet: 192.168.100.0/24
